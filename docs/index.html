<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Including known interactions in SDM • webSDM</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Including known interactions in SDM">
<meta property="og:description" content="Package to fit a trophic Species Distribution Model, analyse it and predict. See Poggiato et al. In prep.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">webSDM</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="Unreleased version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/Introduction.html">Introduction</a>
    </li>
    <li>
      <a href="articles/Differences_with_SDMs.html">Subtles and obvious differences between SDM and trophic SDM</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/giopogg/trophicSDM/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">

<div class="section level1">
<div class="page-header"><h1 id="r-package-websdm">R package ‘webSDM’<a class="anchor" aria-label="anchor" href="#r-package-websdm"></a>
</h1></div>
<p>Giovanni Poggiato 09/11/22</p>
</div>
<div class="section level1">
<h1 id="section">
<img src="reference/figures/logo_jtdm.png" align="right" width="300px"><a class="anchor" aria-label="anchor" href="#section"></a>
</h1>
<p><a href="http://www.repostatus.org/#active" class="external-link"><img src="http://www.repostatus.org/badges/latest/active.svg" alt="Project Status: Active – The project has reached a stable, usable state and is being actively developed."></a> <a href="https://www.gnu.org/licenses/gpl-3.0" class="external-link"><img src="https://img.shields.io/badge/License-GPL%20v3-blue.svg" alt="License: GPL v3"></a></p>
</div>
<div class="section level1">
<h1 id="websdm---including-known-trophic-interactions-in-sdm">webSDM - including known trophic interactions in SDM<a class="anchor" aria-label="anchor" href="#websdm---including-known-trophic-interactions-in-sdm"></a>
</h1>
<p>webSDM implements the trophic SDM model described in Poggiato et al., “Integrating trophic food webs in species distribution models improves ecological niche estimation and prediction”. Trophic SDM integrate a known trophic interaction network in SDM, thus oroviding more realistic and ecologically sound predictions. We here after present a quick introduction to some of the feature of the package, but we refer to the vignettes and the help functions for a more complete documentation of our package.</p>
<div class="section level2">
<h2 id="installing-the-r-package">Installing the R package<a class="anchor" aria-label="anchor" href="#installing-the-r-package"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/" class="external-link">devtools</a></span><span class="op">)</span></span>
<span><span class="co">## Le chargement a nécessité le package : usethis</span></span>
<span><span class="co"># Run to install webSDM</span></span>
<span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"giopogg/webSDM"</span><span class="op">)</span></span>
<span><span class="co">## Skipping install of 'webSDM' from a github remote, the SHA1 (d3d72465) has not changed since last install.</span></span>
<span><span class="co">##   Use `force = TRUE` to force installation</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/giopogg/trophicSDM" class="external-link">webSDM</a></span><span class="op">)</span></span>
<span><span class="co">## Registered S3 method overwritten by 'GGally':</span></span>
<span><span class="co">##   method from   </span></span>
<span><span class="co">##   +.gg   ggplot2</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/rstanarm/" class="external-link">rstanarm</a></span><span class="op">)</span></span>
<span><span class="co">## Le chargement a nécessité le package : Rcpp</span></span>
<span><span class="co">## This is rstanarm version 2.21.3</span></span>
<span><span class="co">## - See https://mc-stan.org/rstanarm/articles/priors for changes to default priors!</span></span>
<span><span class="co">## - Default priors may change, so it's safest to specify priors, even if equivalent to the defaults.</span></span>
<span><span class="co">## - For execution on a local, multicore CPU with excess RAM we recommend calling</span></span>
<span><span class="co">##   options(mc.cores = parallel::detectCores())</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="fit-a-trophic-sdm-to-data">Fit a trophic SDM to data<a class="anchor" aria-label="anchor" href="#fit-a-trophic-sdm-to-data"></a>
</h2>
<p>Fitting a trophic SDM require the species distribution data, the environmental covariates and a known trophic interaction network.<br>
We load a simulated datasets, where Y contains the species distribution data (a site x species matrix), X the environmental covariates (a sites x covariates matrix) and G is an <code>igraph</code> object describing the interaction network (with links going from predators to prey). We specify, for every species, a quadratic relationship with respect to the environment, and we fit a model assuming bottom-up control (i.e., predators are modelled as a function of preys). We fit the trophicSDM in the Bayesian framework.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">Y</span>, <span class="va">G</span><span class="op">)</span></span>
<span></span>
<span><span class="va">m</span> <span class="op">=</span> <span class="fu"><a href="reference/trophicSDM.html">trophicSDM</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="va">Y</span>, X <span class="op">=</span> <span class="va">X</span>, G <span class="op">=</span> <span class="va">G</span>, env.formula <span class="op">=</span> <span class="st">"~ X_1 + X_2"</span>,</span>
<span>               family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span>,</span>
<span>               mode <span class="op">=</span> <span class="st">"prey"</span>, method <span class="op">=</span> <span class="st">"stan_glm"</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="inferred-coefficients">Inferred coefficients<a class="anchor" aria-label="anchor" href="#inferred-coefficients"></a>
</h3>
<p>We can see the formula of each glm in the argument <code>$form.all</code></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span><span class="op">$</span><span class="va">form.all</span></span>
<span><span class="co">## $Y1</span></span>
<span><span class="co">## [1] "y ~ X_1 + X_2"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $Y2</span></span>
<span><span class="co">## [1] "y ~ X_1 + X_2"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $Y3</span></span>
<span><span class="co">## [1] "y ~ X_1 + X_2"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $Y5</span></span>
<span><span class="co">## [1] "y ~ X_1 + X_2+Y1+Y2+Y3"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $Y4</span></span>
<span><span class="co">## [1] "y ~ X_1 + X_2+Y3"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $Y6</span></span>
<span><span class="co">## [1] "y ~ X_1 + X_2+Y3+Y5"</span></span></code></pre></div>
<p>We can have a first look to regression coefficients using the function <code>plot</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/unnamed-chunk-4-1.png"><!-- --></p>
<p>We can access to the regression coefficients (eventually standardised) with the function <code>coef</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">m</span>, standardise <span class="op">=</span> <span class="cn">T</span>, level <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span></span>
<span><span class="co">## $Y1</span></span>
<span><span class="co">##               estimate         5%        95%</span></span>
<span><span class="co">## (Intercept)  0.3356480  0.3356480  0.3356480</span></span>
<span><span class="co">## X_1         -0.1980409 -0.2546844 -0.1392262</span></span>
<span><span class="co">## X_2          0.2573000  0.2056437  0.3131806</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $Y2</span></span>
<span><span class="co">##               estimate         5%         95%</span></span>
<span><span class="co">## (Intercept) -0.2657684 -0.2657684 -0.26576835</span></span>
<span><span class="co">## X_1          0.3844270  0.3229825  0.45524387</span></span>
<span><span class="co">## X_2         -0.0716046 -0.1299509 -0.01609685</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $Y3</span></span>
<span><span class="co">##               estimate         5%        95%</span></span>
<span><span class="co">## (Intercept) -0.6151417 -0.6151417 -0.6151417</span></span>
<span><span class="co">## X_1          0.2673097  0.2131813  0.3253654</span></span>
<span><span class="co">## X_2          0.1995619  0.1378760  0.2697374</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $Y5</span></span>
<span><span class="co">##                estimate          5%         95%</span></span>
<span><span class="co">## (Intercept) -0.61340430 -0.61340430 -0.61340430</span></span>
<span><span class="co">## X_1          0.20163096  0.14485933  0.26338063</span></span>
<span><span class="co">## X_2         -0.30480813 -0.36835133 -0.24049912</span></span>
<span><span class="co">## Y1           0.44004828  0.37312719  0.51568662</span></span>
<span><span class="co">## Y2          -0.02433073 -0.08636042  0.03387327</span></span>
<span><span class="co">## Y3          -0.21123148 -0.26560906 -0.15329877</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $Y4</span></span>
<span><span class="co">##                estimate          5%         95%</span></span>
<span><span class="co">## (Intercept)  0.78480621  0.78480621  0.78480621</span></span>
<span><span class="co">## X_1         -0.17609957 -0.23260354 -0.11722914</span></span>
<span><span class="co">## X_2         -0.01297398 -0.06822776  0.04543659</span></span>
<span><span class="co">## Y3          -0.07202979 -0.13198333 -0.01167572</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $Y6</span></span>
<span><span class="co">##                estimate          5%         95%</span></span>
<span><span class="co">## (Intercept)  1.31804303  1.31804303  1.31804303</span></span>
<span><span class="co">## X_1         -0.03160237 -0.09022924  0.03024488</span></span>
<span><span class="co">## X_2          0.08668384  0.02953393  0.15043882</span></span>
<span><span class="co">## Y3          -0.24074426 -0.30346007 -0.17924240</span></span>
<span><span class="co">## Y5          -0.09962656 -0.16231573 -0.04517635</span></span></code></pre></div>
<p>We can visualise the biotic coefficients with the function <code>plotG_inferred</code></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/plotG_inferred.html">plotG_inferred</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/unnamed-chunk-6-1.png"><!-- --></p>
<p>We can also visualise the importance of each (set of) variable with the function `computeVariableImportance’</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">VarImpo</span> <span class="op">=</span> <span class="fu"><a href="reference/computeVariableImportance.html">computeVariableImportance</a></span><span class="op">(</span><span class="va">m</span>, </span>
<span>                                    groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Abiotic"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"X_1"</span>,<span class="st">"X_2"</span><span class="op">)</span>,</span>
<span>                                                  <span class="st">"Biotic"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Y1"</span>,<span class="st">"Y2"</span>, <span class="st">"Y3"</span>, <span class="st">"Y4"</span>, <span class="st">"Y5"</span>, <span class="st">"Y6"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">VarImpo</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">VarImpo</span>, <span class="fl">2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">/</span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">+</span><span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tab</span> <span class="op">=</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">melt</a></span><span class="op">(</span><span class="va">VarImpo</span><span class="op">)</span></span>
<span><span class="va">tab</span><span class="op">$</span><span class="va">Var2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">tab</span><span class="op">$</span><span class="va">Var2</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">tab</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Var2</span>, y <span class="op">=</span> <span class="va">value</span>, fill <span class="op">=</span> <span class="va">Var1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat<span class="op">=</span><span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/varImpo-1.png"><!-- --></p>
</div>
<div class="section level3">
<h3 id="local-objects">Local objects<a class="anchor" aria-label="anchor" href="#local-objects"></a>
</h3>
<p>We can access each local model in the field <code>$model</code> and then select a given local model, that can be analysed using some the implemented methods</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span><span class="op">$</span><span class="va">model</span><span class="op">$</span><span class="va">Y5</span></span>
<span><span class="co">## ==================================================================</span></span>
<span><span class="co">## Local SDMfit for species Y5 with no penalty , fitted using stan_glm </span></span>
<span><span class="co">## ==================================================================</span></span>
<span><span class="co">## * Useful S3 methods</span></span>
<span><span class="co">##     print(), coef(), plot(), predict()</span></span>
<span><span class="co">##     $model gives the stanreg class object </span></span>
<span><span class="co">## ==================================================================</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="predictions">Predictions<a class="anchor" aria-label="anchor" href="#predictions"></a>
</h3>
<p>We can predict with a fitted trophic SDM in multiple ways. The most straightforward way is to use the function <code>predict</code>. We can for example obtain 50 draws from the posterior predictive distribution of species (pred_samples = 50) using predicted presence-absences of species to predict their predators (prob.cov = TRUE). When we don’t specify Xnew, the function sets Xnew = X by default. We can thus obtain the fitted values of the model and compute goodness of fit metrics. Notice that other metrics like AIC or loo are also available.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Ypred</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">m</span>, fullPost <span class="op">=</span> <span class="cn">FALSE</span>, pred_samples <span class="op">=</span> <span class="fl">50</span>, prob.cov <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co"># predict returns a list contaning for each species the predictive samples at each site</span></span>
<span><span class="co"># But since we specified fullPost = FALSE it only give back the predictive mean and quantiles </span></span>
<span><span class="va">Ypred</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">cbind</span>,</span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">Ypred</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">predictions.mean</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Ypred</span> <span class="op">=</span> <span class="va">Ypred</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="reference/evaluateModelFit.html">evaluateModelFit</a></span><span class="op">(</span><span class="va">m</span>, Ynew <span class="op">=</span> <span class="va">Y</span>, Ypredicted <span class="op">=</span> <span class="va">Ypred</span><span class="op">)</span></span>
<span><span class="co">##         auc       tss species</span></span>
<span><span class="co">## 1 0.6733913 0.2828523      Y1</span></span>
<span><span class="co">## 2 0.7049275 0.3116298      Y2</span></span>
<span><span class="co">## 3 0.6691285 0.2793124      Y3</span></span>
<span><span class="co">## 4 0.5994943 0.1731849      Y4</span></span>
<span><span class="co">## 5 0.6134552 0.2028583      Y5</span></span>
<span><span class="co">## 6 0.5592781 0.1120330      Y6</span></span>
<span></span>
<span><span class="va">m</span><span class="op">$</span><span class="va">log.lik</span></span>
<span><span class="co">## [1] -3638.462</span></span>
<span><span class="va">m</span><span class="op">$</span><span class="va">AIC</span></span>
<span><span class="co">## [1] 7336.924</span></span>
<span><span class="fu"><a href="https://mc-stan.org/loo/reference/loo.html" class="external-link">loo</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span>
<span><span class="co">## [1] -3650.494</span></span></code></pre></div>
<p>We can also evaluate the quality of model predictions using K-fold cross-validation:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CV</span> <span class="op">=</span> <span class="fu"><a href="reference/trophicSDM_CV.html">trophicSDM_CV</a></span><span class="op">(</span><span class="va">m</span>, K <span class="op">=</span> <span class="fl">3</span>, prob.cov <span class="op">=</span> <span class="cn">T</span>, run.parallel <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co"># Transfom in a table</span></span>
<span><span class="va">Ypred</span> <span class="op">=</span> <span class="va">CV</span><span class="op">$</span><span class="va">meanPred</span></span>
<span><span class="co"># Re order columns</span></span>
<span><span class="va">Ypred</span> <span class="op">=</span> <span class="va">Ypred</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="reference/evaluateModelFit.html">evaluateModelFit</a></span><span class="op">(</span><span class="va">m</span>, Ynew <span class="op">=</span> <span class="va">Y</span>, Ypredicted <span class="op">=</span> <span class="va">Ypred</span><span class="op">)</span></span></code></pre></div>
<p>We can now evaluate species probabilities of presence for the enviromental conditions X_1 = 0.5 and X_2 = 0.5.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Pred</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">m</span>, Xnew <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>X_1 <span class="op">=</span> <span class="fl">0.5</span>, X_2 <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>, fullPost <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">cbind</span>, <span class="va">Pred</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">##    predictions.mean predictions.q025 predictions.q975</span></span>
<span><span class="co">## Y1 0.6306295        0.5982156        0.6584504       </span></span>
<span><span class="co">## Y2 0.6876509        0.6581885        0.7243871       </span></span>
<span><span class="co">## Y3 0.7180076        0.6926365        0.7435011       </span></span>
<span><span class="co">## Y5 0.381138         0.08540156       0.7599537       </span></span>
<span><span class="co">## Y4 0.4838677        0.4424159        0.5591465       </span></span>
<span><span class="co">## Y6 0.6237136        0.4813146        0.8234734</span></span></code></pre></div>
<p>We can also obtain an estimation of the fundamental niche, that corresponds, in the bottom-up approach, to the probability of presence of a species given that its preys are present. We can for example compute the probability of presence of species for the enviromental conditions X_1 = 0.5 and X_2 = 0.5 assuming all their preys to be present.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Ypred</span> <span class="op">=</span> <span class="fu"><a href="reference/predictFundamental.html">predictFundamental</a></span><span class="op">(</span><span class="va">m</span>, fullPost <span class="op">=</span> <span class="cn">FALSE</span>, pred_samples <span class="op">=</span> <span class="fl">100</span>, Xnew <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>X_1 <span class="op">=</span> <span class="fl">0.5</span>, X_2 <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="frequentist-approach">Frequentist approach<a class="anchor" aria-label="anchor" href="#frequentist-approach"></a>
</h3>
<p>Notice that we can also fit a trophic SDM in the frequentist approach.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op">=</span> <span class="fu"><a href="reference/trophicSDM.html">trophicSDM</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="va">Y</span>, X <span class="op">=</span> <span class="va">X</span>, G <span class="op">=</span> <span class="va">G</span>, env.formula <span class="op">=</span> <span class="st">"~ X_1 + X_2"</span>,</span>
<span>               family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span>,</span>
<span>               mode <span class="op">=</span> <span class="st">"prey"</span>, method <span class="op">=</span> <span class="st">"glm"</span><span class="op">)</span></span>
<span><span class="co">## [1] "--- Species Y1 ---"</span></span>
<span><span class="co">## [1] "--- Species Y2 ---"</span></span>
<span><span class="co">## [1] "--- Species Y3 ---"</span></span>
<span><span class="co">## [1] "--- Species Y5 ---"</span></span>
<span><span class="co">## [1] "--- Species Y4 ---"</span></span>
<span><span class="co">## [1] "--- Species Y6 ---"</span></span></code></pre></div>
<p>All the above-mentioned functions are also available in the frequentist framework, with adaptations when necessary (e.g. coefficients are significant or not depending on the p-values instead of the credible interval). However, error propagation is not available and we can only obtain one prediction for each species and site, instead of multiple samples in the Bayesian case. ### Penalisation We can infer a sparse model by specifying <code>penal = "horshoe"</code> if we set <code>method = "stan_glm"</code> (i.e. in the Bayesian framework), or <code>penal = "elasticnet"</code> if we set <code>method = "glm"</code> (i.e. in the frequentist framework).</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op">=</span> <span class="fu"><a href="reference/trophicSDM.html">trophicSDM</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="va">Y</span>, X <span class="op">=</span> <span class="va">X</span>, G <span class="op">=</span> <span class="va">G</span>, env.formula <span class="op">=</span> <span class="st">"~ X_1 + X_2"</span>,</span>
<span>               family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span>,</span>
<span>               mode <span class="op">=</span> <span class="st">"prey"</span>, method <span class="op">=</span> <span class="st">"glm"</span>, penal <span class="op">=</span> <span class="st">"elasticnet"</span><span class="op">)</span></span>
<span><span class="co">## [1] "--- Species Y1 ---"</span></span>
<span><span class="co">## [1] "--- Species Y2 ---"</span></span>
<span><span class="co">## [1] "--- Species Y3 ---"</span></span>
<span><span class="co">## [1] "--- Species Y5 ---"</span></span>
<span><span class="co">## [1] "--- Species Y4 ---"</span></span>
<span><span class="co">## [1] "--- Species Y6 ---"</span></span>
<span></span>
<span><span class="va">m</span> <span class="op">=</span> <span class="fu"><a href="reference/trophicSDM.html">trophicSDM</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="va">Y</span>, X <span class="op">=</span> <span class="va">X</span>, G <span class="op">=</span> <span class="va">G</span>, env.formula <span class="op">=</span> <span class="st">"~ X_1 + X_2"</span>,</span>
<span>               family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span>,</span>
<span>               mode <span class="op">=</span> <span class="st">"prey"</span>, method <span class="op">=</span> <span class="st">"stan_glm"</span>, penal <span class="op">=</span> <span class="st">"horshoe"</span><span class="op">)</span></span>
<span><span class="co">## [1] "--- Species Y1 ---"</span></span>
<span><span class="co">## [1] "--- Species Y2 ---"</span></span>
<span><span class="co">## Warning: Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.</span></span>
<span><span class="co">## Running the chains for more iterations may help. See</span></span>
<span><span class="co">## https://mc-stan.org/misc/warnings.html#bulk-ess</span></span>
<span><span class="co">## Warning: Tail Effective Samples Size (ESS) is too low, indicating posterior variances and tail quantiles may be unreliable.</span></span>
<span><span class="co">## Running the chains for more iterations may help. See</span></span>
<span><span class="co">## https://mc-stan.org/misc/warnings.html#tail-ess</span></span>
<span><span class="co">## [1] "--- Species Y3 ---"</span></span>
<span><span class="co">## Warning: Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.</span></span>
<span><span class="co">## Running the chains for more iterations may help. See</span></span>
<span><span class="co">## https://mc-stan.org/misc/warnings.html#bulk-ess</span></span>
<span><span class="co">## [1] "--- Species Y5 ---"</span></span>
<span><span class="co">## Warning: Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.</span></span>
<span><span class="co">## Running the chains for more iterations may help. See</span></span>
<span><span class="co">## https://mc-stan.org/misc/warnings.html#bulk-ess</span></span>
<span></span>
<span><span class="co">## Warning: Tail Effective Samples Size (ESS) is too low, indicating posterior variances and tail quantiles may be unreliable.</span></span>
<span><span class="co">## Running the chains for more iterations may help. See</span></span>
<span><span class="co">## https://mc-stan.org/misc/warnings.html#tail-ess</span></span>
<span><span class="co">## [1] "--- Species Y4 ---"</span></span>
<span><span class="co">## Warning: Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.</span></span>
<span><span class="co">## Running the chains for more iterations may help. See</span></span>
<span><span class="co">## https://mc-stan.org/misc/warnings.html#bulk-ess</span></span>
<span><span class="co">## [1] "--- Species Y6 ---"</span></span>
<span><span class="co">## Warning: Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.</span></span>
<span><span class="co">## Running the chains for more iterations may help. See</span></span>
<span><span class="co">## https://mc-stan.org/misc/warnings.html#bulk-ess</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="composite-variables">Composite variables<a class="anchor" aria-label="anchor" href="#composite-variables"></a>
</h3>
<p>We can include composite variables using the arguments <code>sp.formula</code> and <code>sp.partition</code>. We refer to the vignette ‘Composite variable’ for an exhaustive description of these arguments and how to use them to obtain any kind of model specification. For example, we can model species as a function of of their prey richness.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op">=</span> <span class="fu"><a href="reference/trophicSDM.html">trophicSDM</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="va">Y</span>, X <span class="op">=</span> <span class="va">X</span>, G <span class="op">=</span> <span class="va">G</span>, env.formula <span class="op">=</span> <span class="st">"~ X_1 + X_2"</span>,</span>
<span>               sp.formula <span class="op">=</span> <span class="st">"richness"</span>,</span>
<span>               family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span>,</span>
<span>               mode <span class="op">=</span> <span class="st">"prey"</span>, method <span class="op">=</span> <span class="st">"glm"</span><span class="op">)</span></span>
<span><span class="co">## [1] "--- Species Y1 ---"</span></span>
<span><span class="co">## [1] "--- Species Y2 ---"</span></span>
<span><span class="co">## [1] "--- Species Y3 ---"</span></span>
<span><span class="co">## [1] "--- Species Y5 ---"</span></span>
<span><span class="co">## [1] "--- Species Y4 ---"</span></span>
<span><span class="co">## [1] "--- Species Y6 ---"</span></span>
<span><span class="va">m</span><span class="op">$</span><span class="va">form.all</span></span>
<span><span class="co">## $Y1</span></span>
<span><span class="co">## [1] "y ~ X_1 + X_2"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $Y2</span></span>
<span><span class="co">## [1] "y ~ X_1 + X_2"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $Y3</span></span>
<span><span class="co">## [1] "y ~ X_1 + X_2"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $Y5</span></span>
<span><span class="co">## [1] "y ~ X_1 + X_2+I(Y1+Y2+Y3)"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $Y4</span></span>
<span><span class="co">## [1] "y ~ X_1 + X_2+I(Y3)"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $Y6</span></span>
<span><span class="co">## [1] "y ~ X_1 + X_2+I(Y3+Y5)"</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a>
</h2>
<p>This package is currently developed by Giovanni Poggiato from Laboratoire d’Ecologie Alpine. It is supported by the ANR GAMBAS. The framework implemented in this package is described in: “Integrating trophic food webs in species distribution models improves ecological niche estimation and prediction” Poggiato Giovanni, Jérémy Andréoletti, Laura J. Pollock and Wilfried Thuiller. In preparation.</p>
</div>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/giopogg/trophicSDM/" class="external-link">Browse source code</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="https://www.r-project.org/Licenses/GPL-3" class="external-link">GPL-3</a></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing webSDM</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Giovanni Poggiato <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0003-1957-9764" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Jérémy Andréoletti <br><small class="roles"> Author, contributor </small> <a href="https://orcid.org/0000-0003-1957-9764" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>



  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by Giovanni Poggiato, Jérémy Andréoletti.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
