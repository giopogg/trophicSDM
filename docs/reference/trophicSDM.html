<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Fitting a trophic Species distribution model — trophicSDM • webSDM</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Fitting a trophic Species distribution model — trophicSDM"><meta property="og:description" content='trophicSDM is used to fit a trophic species distribution model. Requires the species distribution data Y (the sites x species matrix), explanatory variables X and a directed acyclic graph G containing species interactions (i.e., the metaweb, with links going from predators to prey). The function fits the distribution of each species as a function of their preys (with mode = "prey", by default) or predators (if set mode = "predator").'><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">webSDM</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/Introduction.html">Introduction</a>
    </li>
    <li>
      <a href="../articles/Differences_with_SDMs.html">Subtles and obvious differences between SDM and trophic SDM</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/giopogg/trophicSDM/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Fitting a trophic Species distribution model</h1>
    <small class="dont-index">Source: <a href="https://github.com/giopogg/trophicSDM/blob/HEAD/R/trophicSDM.R" class="external-link"><code>R/trophicSDM.R</code></a></small>
    <div class="hidden name"><code>trophicSDM.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>trophicSDM is used to fit a trophic species distribution model. Requires the species distribution data Y (the sites x species matrix), explanatory variables X and a directed acyclic graph G containing species interactions (i.e., the metaweb, with links going from predators to prey). The function fits the distribution of each species as a function of their preys (with mode = "prey", by default) or predators (if set mode = "predator").</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">trophicSDM</span><span class="op">(</span></span>
<span>  <span class="va">Y</span>,</span>
<span>  <span class="va">X</span>,</span>
<span>  <span class="va">G</span>,</span>
<span>  env.formula <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  sp.formula <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  sp.partition <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  penal <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  mode <span class="op">=</span> <span class="st">"prey"</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"stan_glm"</span>,</span>
<span>  <span class="va">family</span>,</span>
<span>  iter <span class="op">=</span> <span class="fl">500</span>,</span>
<span>  chains <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  run.parallel <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>Y</dt>
<dd><p>The sites x species matrix containing observed species distribution (e.g. presence-absence).</p></dd>


<dt>X</dt>
<dd><p>The design matrix, i.e. sites x predictor matrix containing the value of each explanatory variable (e.g. the environmental conditions) at each site.</p></dd>


<dt>G</dt>
<dd><p>The species interaction network (aka metaweb). Needs to be an igraph object. Links must go from predator to preys. It needs to be a directed acyclic graph.</p></dd>


<dt>env.formula</dt>
<dd><p>The definition of the abitic part of the model. It can be :</p><ul><li><p>a string specifying the formula (e.g. "~ X_1 + X_2"). In this case, the same environmental variables are used for every species.</p></li>
<li><p>A list that contains for each species the formula that describes the abiotic part of the model. In this case, different species can be modeled as a function of different environmental covariates. The names of the list must coincide with the names of the species.</p></li>
</ul></dd>


<dt>sp.formula</dt>
<dd><p>(optional) It allows to specify a particular definition of the biotic part of the model, e.g., using composite variables (e.g., richness), or an interaction of the biotic and abitic component. More details in 'Details'.</p></dd>


<dt>sp.partition</dt>
<dd><p>(optional) a list to specify groups of species that are used to compute composite variables, e.g., a species can be modelled as a function of the richness of each group of preys. It has to be a list, each element is a vector containing the names of species in the group. More details in 'Details'.</p></dd>


<dt>penal</dt>
<dd><p>Penalisation method to shrink regression coefficients. If <code>NULL</code> (default), the model does not penalise the regression coefficient. For now, available penalization method are  <code>"horshoe"</code> for method stan_glm, <code>"elasticnet"</code> for method glm. It is also possible to constrain the sign of biotic coefficients (prey coefficients are set to posite and predator coefficients to negative) by setting <code>"coeff.signs"</code> for methods glm and stan_glm.</p></dd>


<dt>mode</dt>
<dd><p>"prey" if bottom-up control (default), "predators" otherwise. Notice that G needs to be such that links point from predators to prey.</p></dd>


<dt>method</dt>
<dd><p>which SDM method to use. For now the available choises are: <code>"glm"</code> (frequentist) or <code>"stan_glm"</code> (full bayesian MCMC, default). Notice that using "glm" does not allow error propagation when predicting.</p></dd>


<dt>family</dt>
<dd><p>the family parameter of the glm function (see <code>glm</code>). <code>gaussian(link = "identity")</code> for gaussian data. <code>binomial(link = "logit")</code> or <code>binomial(link = "probit")</code> for presence-absence data.</p></dd>


<dt>iter</dt>
<dd><p>(for <code>"stan_glm"</code> only) Number of iterations for each MCMC chain if stan_glm is used</p></dd>


<dt>chains</dt>
<dd><p>(for <code>"stan_glm"</code> only) Number of MCMC chains (default to 2)</p></dd>


<dt>run.parallel</dt>
<dd><p>Whether species models are fitted in parallel (can speed computational up time). Default to <code>FALSE</code>.</p></dd>


<dt>verbose</dt>
<dd><p>Whether to print algorithm progresses</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>A "trophicSDMfit" object, containing:</p>
<dl><dt>model</dt>
<dd><p>A list containing the local models (i.e. a SDM for each species). Each local model is an object of class "SDMfit". See <code><a href="SDMfit.html">?SDMfit</a></code> for more informations.</p></dd>

<dt>Y</dt>
<dd><p>A numeric vector of standard errors on parameters</p></dd>


<dt>form.all</dt>
<dd><p>A list describing each species formula (both biotic and abiotic terms)</p></dd>


<dt>data</dt>
<dd><p>A list containing all the data used to fit the model</p></dd>


<dt>model.call</dt>
<dd><p>A list containing the modeling choices of the fitted model (e.g. method, penalisation...)</p></dd>


<dt>coef</dt>
<dd><p>A list containing, for each species, the inferred coefficients (with credible intervals or p-values when available)</p></dd>

<dt>MCMC.diag</dt>
<dd><p>MCMC convergence metrics, only available for MCMC methods</p></dd>


<dt>AIC</dt>
<dd><p>Model's AIC</p></dd>


<dt>log.lik</dt>
<dd><p>Model's log.likelihood</p></dd>

</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>"sp.formula" and "sp.partition" can be combined to define any kind of composite variables for the biotic part of the formula. "sp.formula" can be :</p><ul><li><p>A string defining a formula as function of "richness". E.g., <code>"richness+I(richness)^2"</code> (species are modelled as a function of a quadratic polyome of their prey richness), <code>"I(richness&gt;0)"</code> (species are modelled as a function of a dummy variable that is equal to 1 when at least one species is present). Importantly, when group of preys (or predators) are specified by "sp.partition", species are modeled as a function of the composite variable specified by "sp.formula" for each of their prey (or predator) groups.</p></li>
<li><p>A more flexible option is to specify sp.formula as a list (whose names are species' names) that contains for each species the definition of the biotic part of the model. Notice that, in this case, the function does not check that the model is a DAG. This allow to define any kind of composite variable, or to model interactions between environmental covariates and preys (or predators).</p></li>
</ul></div>
    <div id="author">
    <h2>Author</h2>
    <p>Giovanni Poggiato and Jérémy Andréletti</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">Y</span>, <span class="va">X</span>, <span class="va">G</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># define abiotic part of the model</span></span></span>
<span class="r-in"><span><span class="va">env.formula</span> <span class="op">=</span> <span class="st">"~ X_1 + X_2"</span></span></span>
<span class="r-in"><span><span class="co"># Run the model with bottom-up control using stan_glm as fitting method and no penalisation</span></span></span>
<span class="r-in"><span><span class="va">m</span> <span class="op">=</span> <span class="fu">trophicSDM</span><span class="op">(</span><span class="va">Y</span>,<span class="va">X</span>,<span class="va">G</span>, <span class="va">env.formula</span>, </span></span>
<span class="r-in"><span>               family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span>, penal <span class="op">=</span> <span class="cn">NULL</span>, </span></span>
<span class="r-in"><span>               mode <span class="op">=</span> <span class="st">"prey"</span>, method <span class="op">=</span> <span class="st">"stan_glm"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "--- Species Y1 ---"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "--- Species Y2 ---"</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> Running the chains for more iterations may help. See</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> https://mc-stan.org/misc/warnings.html#bulk-ess</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Tail Effective Samples Size (ESS) is too low, indicating posterior variances and tail quantiles may be unreliable.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> Running the chains for more iterations may help. See</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> https://mc-stan.org/misc/warnings.html#tail-ess</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "--- Species Y3 ---"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "--- Species Y5 ---"</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Tail Effective Samples Size (ESS) is too low, indicating posterior variances and tail quantiles may be unreliable.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> Running the chains for more iterations may help. See</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> https://mc-stan.org/misc/warnings.html#tail-ess</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "--- Species Y4 ---"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "--- Species Y6 ---"</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ==================================================================</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> A trophicSDM fit with no penalty, fitted using stan_glm </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  with a bottom-up approach </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Number of species : 6 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Number of links : 6 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ==================================================================</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> * Useful fields</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     $coef </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> * Useful S3 methods</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     print(), coef(), plot(), predict(), evaluateModelFit() </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     predictFundamental(), plotG(), plotG_inferred(), computeVariableImportance() </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> * Local models (i.e. single species SDM) can be accessed through </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     $model</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Access local models (e.g. species "Y5")</span></span></span>
<span class="r-in"><span><span class="va">m</span><span class="op">$</span><span class="va">model</span><span class="op">$</span><span class="va">Y5</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ==================================================================</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Local SDMfit for species Y5 with no penalty , fitted using stan_glm </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ==================================================================</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> * Useful S3 methods</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     print(), coef(), plot(), predict()</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     $model gives the stanreg class object </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ==================================================================</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">m</span><span class="op">$</span><span class="va">model</span><span class="op">$</span><span class="va">Y5</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   mean       2.5%      97.5%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept) -0.6072851 -1.0670483 -0.1585365</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X_1          1.4831383  0.9198980  2.0070599</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X_2         -2.2905763 -2.8020410 -1.7325982</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Y1           1.9609420  1.6260514  2.3129873</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Y2          -0.1020190 -0.4238213  0.2554132</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Y3          -0.9948627 -1.3175241 -0.7091001</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">m</span><span class="op">$</span><span class="va">model</span><span class="op">$</span><span class="va">Y5</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="trophicSDM-1.png" alt="" width="700" height="433"></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Giovanni Poggiato, Jérémy Andréoletti.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer></div>

  


  

  </body></html>

