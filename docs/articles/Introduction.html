<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to trophic SDM • webSDM</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to trophic SDM">
<meta property="og:description" content="webSDM">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">webSDM</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1-3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Introduction.html">Introduction</a>
    </li>
    <li>
      <a href="../articles/Composite_variables.html">Composite variables and biotic-abiotic interactions</a>
    </li>
    <li>
      <a href="../articles/Differences_with_SDMs.html">Subtle and obvious differences between SDM and trophic SDM</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/giopogg/webSDM/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to trophic SDM</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/giopogg/webSDM/blob/HEAD/vignettes/Introduction.Rmd" class="external-link"><code>vignettes/Introduction.Rmd</code></a></small>
      <div class="hidden name"><code>Introduction.Rmd</code></div>

    </div>

    
    
<p>In this vignette we explain how to fit, evaluate and interpret a trophic species distribution model (trophic SDM). Trophic SDM is a statistical model to model the distribution of species accounting for their known trophic interactions. We refer to Poggiato et al., “Integrating trophic food webs in species distribution models improves ecological niche estimation and prediction”, in preparation for the full description of trophic SDM.</p>
<div class="section level2">
<h2 id="install-and-load-websdm">Install and load webSDM<a class="anchor" aria-label="anchor" href="#install-and-load-websdm"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/" class="external-link">devtools</a></span><span class="op">)</span></span>
<span><span class="co"># Run to install webSDM</span></span>
<span><span class="co"># install_github("giopogg/webSDM")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/giopogg/webSDM" class="external-link">webSDM</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/bayesplot/" class="external-link">bayesplot</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">gridExtra</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hadley/reshape" class="external-link">reshape2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/loo/" class="external-link">loo</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="simulate-data">Simulate data<a class="anchor" aria-label="anchor" href="#simulate-data"></a>
</h2>
<p>For illustrative purposes, we use simulated data for which we know the parameter values. We thus simulate a trophic interaction network and species distribution for six species, whose names are ordered accordingly to their trophic level (Y1 being basal and Y6 being at the highest trophic position). We simulate data with a stronger dependence on the abiotic variables for species in lower trophic levels, and increasing dependence on the biotic terms (i.e., their preys) for species with a higher trophic level. We will then use trophic SDM and see if the model can retrieve this simulate process and the species fundamental niches.</p>
<div class="section level3">
<h3 id="create-trophic-interaction-network">Create trophic interaction network<a class="anchor" aria-label="anchor" href="#create-trophic-interaction-network"></a>
</h3>
<p>We first create the trophic interaction network. The network needs to be a directed acyclic graph (DAG), with arrows pointing from predator to prey. We thus simulate an interaction network such that species only have prey in a lower trophic position.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set number of species</span></span>
<span><span class="va">S</span> <span class="op">=</span> <span class="fl">6</span></span>
<span><span class="co"># Create the adjacency matrix of the graph</span></span>
<span><span class="va">A</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>,nrow<span class="op">=</span><span class="va">S</span>,ncol<span class="op">=</span><span class="va">S</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Ensure that the graph is connected</span></span>
<span><span class="kw">while</span><span class="op">(</span><span class="op">!</span><span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/components.html" class="external-link">is.connected</a></span><span class="op">(</span><span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/graph_from_adjacency_matrix.html" class="external-link">graph_from_adjacency_matrix</a></span><span class="op">(</span><span class="va">A</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">A</span> <span class="op">=</span> <span class="va">A_w</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>,nrow<span class="op">=</span><span class="va">S</span>,ncol<span class="op">=</span><span class="va">S</span><span class="op">)</span></span>
<span>  <span class="co"># Create links (i.e. zeros and ones of the adjacency matrix)</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">S</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">A</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">(</span><span class="va">j</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="va">S</span><span class="op">)</span>,<span class="va">j</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, <span class="va">S</span><span class="op">-</span><span class="va">j</span>, replace <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="co"># Sample weights for each link</span></span>
<span>  <span class="co">#A_w[which(A != 0)] = runif(1,min=0,max=2)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">A</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">A</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Y"</span>,<span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">S</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Build an igraph object from A</span></span>
<span><span class="va">G</span> <span class="op">=</span> <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/graph_from_adjacency_matrix.html" class="external-link">graph_from_adjacency_matrix</a></span><span class="op">(</span><span class="va">A</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">G</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="fig/simulate_graph-1.png" alt=""><p class="caption">plot of chunk simulate_graph</p>
</div>
</div>
<div class="section level3">
<h3 id="simulate-data-1">Simulate data<a class="anchor" aria-label="anchor" href="#simulate-data-1"></a>
</h3>
<p>We now simulate species distribution at 300 locations along two environmental gradients. We simulate species such that species Y1 to Y3 have a negative dependence to the first environmental variable X_1 and a positive dependence to X_2, viceversa for species Y4 to Y6. Moreover, the strength of the environmental term decreases along the trophic level, while the effect of the prey increases. Finally, preys always have a positive effect on predators.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Number of sites</span></span>
<span><span class="va">n</span> <span class="op">=</span> <span class="fl">500</span></span>
<span></span>
<span><span class="co"># Simulate environmental gradient</span></span>
<span><span class="va">X_1</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n</span>, max <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">X_2</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n</span>, max <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">X</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">X_1</span><span class="op">^</span><span class="fl">2</span>, <span class="va">X_2</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">B</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>,</span>
<span>             <span class="op">-</span><span class="fl">2</span>, <span class="op">-</span><span class="fl">2</span>, <span class="op">-</span><span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>,</span>
<span>             <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="op">-</span><span class="fl">2</span>, <span class="op">-</span><span class="fl">2</span>, <span class="op">-</span><span class="fl">2</span></span>
<span>             <span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Sample the distribution of each species as a logit model as a function of the</span></span>
<span><span class="co"># environment and the distribution of preys</span></span>
<span><span class="va">Y</span> <span class="op">=</span> <span class="va">V</span> <span class="op">=</span> <span class="va">prob</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, nrow <span class="op">=</span> <span class="va">n</span>, ncol <span class="op">=</span> <span class="va">S</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">S</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co"># The logit of the probability of presence of each species is given by the </span></span>
<span>  <span class="co"># effect of the environment and of the preys.</span></span>
<span>  </span>
<span>  <span class="co"># Create the linear term. As j increases, the weight of the environmental effect </span></span>
<span>  <span class="co"># decreases and the biotic effect increases</span></span>
<span>  <span class="va">eff_bio</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.9</span>, length.out <span class="op">=</span> <span class="va">S</span><span class="op">)</span><span class="op">[</span><span class="va">j</span><span class="op">]</span></span>
<span>  <span class="va">eff_abio</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.9</span>, length.out <span class="op">=</span> <span class="va">S</span><span class="op">)</span><span class="op">[</span><span class="va">S</span><span class="op">+</span><span class="fl">1</span><span class="op">-</span><span class="va">j</span><span class="op">]</span></span>
<span>  <span class="va">V</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span><span class="op">=</span> <span class="va">eff_abio</span><span class="op">*</span><span class="va">X</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="va">B</span><span class="op">[</span><span class="va">j</span>,<span class="op">]</span> <span class="op">+</span> <span class="va">eff_bio</span><span class="op">*</span><span class="va">Y</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="va">A</span><span class="op">[</span><span class="va">j</span>,<span class="op">]</span><span class="op">*</span><span class="fl">3</span></span>
<span>  <span class="co"># Transform to logit</span></span>
<span>  <span class="va">prob</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span> <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">V</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="co"># Sample the probability of presence</span></span>
<span>  <span class="va">Y</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, size <span class="op">=</span> <span class="fl">1</span>, prob <span class="op">=</span> <span class="va">prob</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Set names</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Y"</span>,<span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">S</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="fit-trophic-sdm">Fit trophic SDM<a class="anchor" aria-label="anchor" href="#fit-trophic-sdm"></a>
</h2>
<p>Now that we simulate the data, we can fit a species distribution model with the function <code>trophicSDM</code>. The function requires the species distribution data <code>Y</code> (a sites x species matrix), the environmental variables <code>X</code> and an igraph object <code>G</code> representing the trophic interaction network. Importantly, <code>G</code> must be acyclic and arrows must point from predator to prey. Finally, the user has to specify a formula for the environmental part of the model and the description of the error distribution and link function to be used in the model (parameter <code>family</code>), just as with any <code>glm</code>.<br>
By default, <code>trophicSDM</code> models each species as a function of their prey (set <code>mode = "predator"</code> to model species as a function of their predators) and of the environmental variables (as defined in <code>env.formula</code>). Trophic SDM can be also fitted as a function of the summary variables of preys (i.e. composite variables like prey richness), instead of each prey species directly. We cover this topic in the vignette ‘Composite variables’.<br>
The algorithm behind trophic SDM fits a set of generalised linear model (glm), one for each species. These glm can be fitted in the frequentist framework by relying on the function <code>glm</code> (set <code>method = "glm"</code>), or in the Bayesian framework by relying on the function <code>rstanarm</code> (set <code>method = "stan_glm"</code>, the default choice). Model fitting is parallelised if <code>run.parallel = TRUE</code>. These glm can be penalised to shrink regression coefficients (by default the model is run without penalisation). In the Bayesian framework set <code>penal = "horshoe"</code> to implement penalised glm using horshoe prior. In the frequentist framework set <code>penal = "elasticnet"</code> to implement penalised glm with elasticnet. See the examples in <code><a href="../reference/trophicSDM.html">?trophicSDM</a></code>. Hereafter, we only fit trophic SDM in the Bayesian framework with no penalisation. However, all the functions and analyses (except for MCMC diagnostic) presented in this vignette applies straightforwardly with or without penalisation and in the frequentist framework.</p>
<p>Hereafter we model species as a function of preys and the two environmental covariates in the Bayesian framework without penalisation. We though need to specify the parameters of the MCMC chains. We need to decide how many chains to sample (<code>chains</code>), how many samples to obtain per chain (<code>iter</code>), and if we wish to see the progress of the MCMC sampling (<code>verbose</code>).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">iter</span> <span class="op">=</span> <span class="fl">1000</span></span>
<span><span class="va">verbose</span> <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="va">nchains</span> <span class="op">=</span> <span class="fl">2</span></span></code></pre></div>
<p>We are now ready to fit a trophic SDM.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">X</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>X_1 <span class="op">=</span> <span class="va">X_1</span>, X_2 <span class="op">=</span> <span class="va">X_2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">m</span> <span class="op">=</span> <span class="fu"><a href="../reference/trophicSDM.html">trophicSDM</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="va">Y</span>, X <span class="op">=</span> <span class="va">X</span>, G <span class="op">=</span> <span class="va">G</span>, </span>
<span>               env.formula <span class="op">=</span> <span class="st">"~ I(X_1^2) + I(X_2^2)"</span>,</span>
<span>               family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span>, </span>
<span>               method <span class="op">=</span> <span class="st">"stan_glm"</span>, chains <span class="op">=</span> <span class="va">nchains</span>, iter <span class="op">=</span> <span class="va">iter</span>, verbose <span class="op">=</span> <span class="va">verbose</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="a-trophicsdmfit-object">A trophicSDMfit object<a class="anchor" aria-label="anchor" href="#a-trophicsdmfit-object"></a>
</h3>
<p>The fitted model <code>m</code> is of class <code>"trophicSDMfit"</code>. We also show here the formulas used to fit the each glm, where each predator is modeled as a function of the preys and of the environmental variables.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span></span>
<span><span class="co">#&gt; ==================================================================</span></span>
<span><span class="co">#&gt; A trophicSDM fit with no penalty, fitted using stan_glm </span></span>
<span><span class="co">#&gt;  with a bottom-up approach </span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt;  Number of species : 6 </span></span>
<span><span class="co">#&gt;  Number of links : 10 </span></span>
<span><span class="co">#&gt; ==================================================================</span></span>
<span><span class="co">#&gt; * Useful fields</span></span>
<span><span class="co">#&gt;     $coef </span></span>
<span><span class="co">#&gt; * Useful S3 methods</span></span>
<span><span class="co">#&gt;     print(), coef(), plot(), predict(), evaluateModelFit() </span></span>
<span><span class="co">#&gt;     predictFundamental(), plotG(), plotG_inferred(), computeVariableImportance() </span></span>
<span><span class="co">#&gt; * Local models (i.e. single species SDM) can be accessed through </span></span>
<span><span class="co">#&gt;     $model</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "trophicSDMfit"</span></span>
<span></span>
<span><span class="va">m</span><span class="op">$</span><span class="va">form.all</span></span>
<span><span class="co">#&gt; $Y1</span></span>
<span><span class="co">#&gt; [1] "y ~ I(X_1^2) + I(X_2^2)"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Y2</span></span>
<span><span class="co">#&gt; [1] "y ~ I(X_1^2)+I(X_2^2)+Y1"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Y3</span></span>
<span><span class="co">#&gt; [1] "y ~ I(X_1^2)+I(X_2^2)+Y1+Y2"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Y4</span></span>
<span><span class="co">#&gt; [1] "y ~ I(X_1^2)+I(X_2^2)+Y1+Y3"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Y5</span></span>
<span><span class="co">#&gt; [1] "y ~ I(X_1^2)+I(X_2^2)+Y1+Y3+Y4"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Y6</span></span>
<span><span class="co">#&gt; [1] "y ~ I(X_1^2)+I(X_2^2)+Y3+Y5"</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="analyse-a-fitted-trophicsdm">Analyse a fitted trophicSDM<a class="anchor" aria-label="anchor" href="#analyse-a-fitted-trophicsdm"></a>
</h2>
<p>The field <code>$model</code> contains all the the single species glm (i.e., all the local models). <code>$data</code> and <code>trophicSDM</code> contains informations on the data and choices to fit the model respectively. <code>$form.all</code> contains the formula used to fit each glm (i.e., both abiotic and biotic terms). <code>$coef</code> contains the inferred regression coefficients of the glm for all species. <code>$AIC</code> and <code>$log.lik</code> are respectively the AIC and log-likelihood of the fitted trophic SDM. Finally, in the Bayesian framework, the field <code>$mcmc.diag</code> contains the convergence diagnostic metrics of the MCMC chains for each species.</p>
<p>In this vignette, we first ensure that the MCMC chains correctly converged. Then, we analyse the inferred model, by focusing in particular on the effect of the biotic versus abiotic terms. We then analyse the predictive performances of the model (comparing it to environment-only SDM) and use it to predict the species fundamental niches.</p>
<div class="section level3">
<h3 id="mcmc-convergence">MCMC convergence<a class="anchor" aria-label="anchor" href="#mcmc-convergence"></a>
</h3>
<p>First, we can have a look at effective sample size to total sample size and of the potential scale reduction factor (aka ‘R hat’) for each species. Each line corresponds to a given parameter.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot mcmc potential scale reduction factor (aka rhat)</span></span>
<span><span class="va">p1</span> <span class="op">=</span> <span class="fu"><a href="https://mc-stan.org/bayesplot/reference/MCMC-diagnostics.html" class="external-link">mcmc_rhat</a></span><span class="op">(</span><span class="va">m</span><span class="op">$</span><span class="va">mcmc.diag</span><span class="op">$</span><span class="va">rhat</span><span class="op">)</span></span>
<span><span class="co"># Plot mcmc ratio of effective sample size to total sample size</span></span>
<span><span class="va">p2</span> <span class="op">=</span> <span class="fu"><a href="https://mc-stan.org/bayesplot/reference/MCMC-diagnostics.html" class="external-link">mcmc_neff</a></span><span class="op">(</span><span class="va">m</span><span class="op">$</span><span class="va">mcmc.diag</span><span class="op">$</span><span class="va">neff.ratio</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="fig/mcmc-convergence-I-1.png" alt=""><p class="caption">plot of chunk mcmc-convergence-I</p>
</div>
<p>We observe that the effective sample sizes are very close to the theoretical value of the actual number of samples, as the ratio is close to 1. In few cases the ratio is lower, and we might consider running the chains for longer, or thin them, to improve convergence. This indicates that there is very little autocorrelation among consecutive samples. The potential scale reduction factors are very close to one, which indicates that two chains gave consistent results. We can have a closer look to the MCMC chains by looking at the traceplots of the parameters of a given model, for example here for species Y5 who feeds on species Y1, Y2, Y3 and Y4. To do so, we first assess the local model of species Y5, and in particular its field <code>$model</code> that gives us the output of the function <code>stan_glm</code>. We can then exploit the plot method of this object.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">m</span><span class="op">$</span><span class="va">model</span><span class="op">$</span><span class="va">Y5</span><span class="op">$</span><span class="va">model</span>, <span class="st">"trace"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="fig/mcmc-convergence-II-1.png" alt=""><p class="caption">plot of chunk mcmc-convergence-II</p>
</div>
<p>Again, we see that the chains mix very well and that there’s little autocorrelation among samples within the same chain.</p>
</div>
<div class="section level3">
<h3 id="parameter-estimates-and-interpretation">Parameter estimates and interpretation<a class="anchor" aria-label="anchor" href="#parameter-estimates-and-interpretation"></a>
</h3>
<p>We now analyse the estimates of the regression coefficients. We can have a first glance of the regression coefficients with the function plot. This function plots the posterior distribution of the regression coefficients of each species.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="fig/estimates-I-1.png" alt=""><p class="caption">plot of chunk estimates-I</p>
</div>
<p>We can visually see that the regression coefficients for the environmental part of the model match the simulated parameters, as species Y1 to Y3 have a positive response to X_1 and a negative one to X_2, viceversa for species Y3 to Y6. We also remark that the environmental coefficients are less important for basal species than for predators. Indeed, the posterior mean of the regression coefficients of the environmental part gets closer to zero and their posterior distribution tend to overlap zero more and more as we move from species Y1 to species Y6. We can quantify this visual assessment by looking at the posterior mean and quantile of the regression coefficients. The parameter <code>level</code> set the probability of the quantile (default 0.95).</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">m</span>, level <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span></span>
<span><span class="co">#&gt; $Y1</span></span>
<span><span class="co">#&gt;                  mean         5%       95%</span></span>
<span><span class="co">#&gt; (Intercept)  1.193315  0.8631366  1.551786</span></span>
<span><span class="co">#&gt; I(X_1^2)    -2.153769 -2.4827322 -1.854351</span></span>
<span><span class="co">#&gt; I(X_2^2)     1.904532  1.5618766  2.281827</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Y2</span></span>
<span><span class="co">#&gt;                   mean          5%        95%</span></span>
<span><span class="co">#&gt; (Intercept)  0.4378192 -0.05096073  0.9425659</span></span>
<span><span class="co">#&gt; I(X_1^2)    -1.3103497 -1.64827655 -0.9781233</span></span>
<span><span class="co">#&gt; I(X_2^2)     1.6693748  1.28262664  2.0953004</span></span>
<span><span class="co">#&gt; Y1           1.1014760  0.60271353  1.6253656</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Y3</span></span>
<span><span class="co">#&gt;                   mean         5%       95%</span></span>
<span><span class="co">#&gt; (Intercept)  0.9246159  0.3048754  1.537713</span></span>
<span><span class="co">#&gt; I(X_1^2)    -1.3782372 -1.7729318 -1.011603</span></span>
<span><span class="co">#&gt; I(X_2^2)     1.2837309  0.8501504  1.799605</span></span>
<span><span class="co">#&gt; Y1           0.8750454  0.2487845  1.523552</span></span>
<span><span class="co">#&gt; Y2           1.3356857  0.7836524  1.874160</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Y4</span></span>
<span><span class="co">#&gt;                  mean         5%        95%</span></span>
<span><span class="co">#&gt; (Intercept) -0.149971 -0.9501498  0.6711274</span></span>
<span><span class="co">#&gt; I(X_1^2)     1.132746  0.7019883  1.5938620</span></span>
<span><span class="co">#&gt; I(X_2^2)    -1.138931 -1.5981180 -0.6976561</span></span>
<span><span class="co">#&gt; Y1           2.550784  1.6477388  3.4849039</span></span>
<span><span class="co">#&gt; Y3           2.000125  1.2299528  2.9196692</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Y5</span></span>
<span><span class="co">#&gt;                   mean          5%        95%</span></span>
<span><span class="co">#&gt; (Intercept)  0.5543470 -0.78446747  2.0315709</span></span>
<span><span class="co">#&gt; I(X_1^2)     0.9714739  0.01583068  1.9503350</span></span>
<span><span class="co">#&gt; I(X_2^2)    -1.4183446 -2.61590362 -0.2213468</span></span>
<span><span class="co">#&gt; Y1           2.9289062  0.28313833  6.4031659</span></span>
<span><span class="co">#&gt; Y3           4.6412922  1.98733697  7.6986728</span></span>
<span><span class="co">#&gt; Y4           2.0493295  0.68591358  3.5493089</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Y6</span></span>
<span><span class="co">#&gt;                   mean         5%       95%</span></span>
<span><span class="co">#&gt; (Intercept) -0.2653839 -2.0546623 1.7166369</span></span>
<span><span class="co">#&gt; I(X_1^2)     0.1022363 -0.8775113 0.9815609</span></span>
<span><span class="co">#&gt; I(X_2^2)    -0.2503882 -1.2390232 0.8521640</span></span>
<span><span class="co">#&gt; Y3           3.8033136  1.3748090 6.6390156</span></span>
<span><span class="co">#&gt; Y5           3.6530362  1.9951208 5.4587375</span></span></code></pre></div>
<p>Notice that regression coefficients are directly available in the field <code>$coef</code> of an object trophicSDMfit (with <code>level = 0.95</code>). As we previously hinted, we see that the estimate of the regression coefficients of the environmental part get closer and closer to zero with credible interval that often overlap zero (implying they are not significant with a confidence level of 10%) for species with a higher trophic level. In order to be able to correctly quantify the effect of the different predictors across species (i.e., their relative importance), we need to standardise the regression coefficients (see Grace et al. 2018). To do so, we need to set <code>standardise = TRUE</code>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">m</span>, level <span class="op">=</span> <span class="fl">0.9</span>, standardise <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="co">#&gt; $Y1</span></span>
<span><span class="co">#&gt;               estimate         5%        95%</span></span>
<span><span class="co">#&gt; (Intercept)  1.1933152  1.1933152  1.1933152</span></span>
<span><span class="co">#&gt; I(X_1^2)    -0.6032735 -0.6954163 -0.5194061</span></span>
<span><span class="co">#&gt; I(X_2^2)     0.5524401  0.4530474  0.6618806</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Y2</span></span>
<span><span class="co">#&gt;               estimate          5%        95%</span></span>
<span><span class="co">#&gt; (Intercept)  0.4378192  0.43781923  0.4378192</span></span>
<span><span class="co">#&gt; I(X_1^2)    -0.3967764 -0.49910135 -0.2961777</span></span>
<span><span class="co">#&gt; I(X_2^2)     0.5234732  0.40219885  0.6570325</span></span>
<span><span class="co">#&gt; Y1           0.1815471  0.09934023  0.2678954</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Y3</span></span>
<span><span class="co">#&gt;               estimate          5%        95%</span></span>
<span><span class="co">#&gt; (Intercept)  0.9246159  0.92461585  0.9246159</span></span>
<span><span class="co">#&gt; I(X_1^2)    -0.4018688 -0.51695451 -0.2949649</span></span>
<span><span class="co">#&gt; I(X_2^2)     0.3876289  0.25670715  0.5433997</span></span>
<span><span class="co">#&gt; Y1           0.1388822  0.03948565  0.2418093</span></span>
<span><span class="co">#&gt; Y2           0.2027708  0.11896649  0.2845168</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Y4</span></span>
<span><span class="co">#&gt;               estimate         5%        95%</span></span>
<span><span class="co">#&gt; (Intercept) -0.1499710 -0.1499710 -0.1499710</span></span>
<span><span class="co">#&gt; I(X_1^2)     0.4526599  0.2805236  0.6369279</span></span>
<span><span class="co">#&gt; I(X_2^2)    -0.4713231 -0.6613485 -0.2887107</span></span>
<span><span class="co">#&gt; Y1           0.5548413  0.3584128  0.7580292</span></span>
<span><span class="co">#&gt; Y3           0.3802667  0.2338405  0.5550919</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Y5</span></span>
<span><span class="co">#&gt;               estimate           5%         95%</span></span>
<span><span class="co">#&gt; (Intercept)  0.5543470  0.554346969  0.55434697</span></span>
<span><span class="co">#&gt; I(X_1^2)     0.2802264  0.004566439  0.56258369</span></span>
<span><span class="co">#&gt; I(X_2^2)    -0.4236835 -0.781414685 -0.06612002</span></span>
<span><span class="co">#&gt; Y1           0.4598741  0.044456182  1.00537537</span></span>
<span><span class="co">#&gt; Y3           0.6369546  0.272735138  1.05653878</span></span>
<span><span class="co">#&gt; Y4           0.1881906  0.062987653  0.32593412</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Y6</span></span>
<span><span class="co">#&gt;                estimate          5%        95%</span></span>
<span><span class="co">#&gt; (Intercept) -0.26538390 -0.26538390 -0.2653839</span></span>
<span><span class="co">#&gt; I(X_1^2)     0.03710176 -0.31845069  0.3562105</span></span>
<span><span class="co">#&gt; I(X_2^2)    -0.09409905 -0.46564058  0.3202540</span></span>
<span><span class="co">#&gt; Y3           0.65666409  0.23736872  1.1462645</span></span>
<span><span class="co">#&gt; Y5           0.17503112  0.09559397  0.2615493</span></span></code></pre></div>
<p>This results confirms the previous analysis. We can analyse the relative importance of different group of variables with the function <code>computeVariableImportance</code>. This function can take as input the definition of groups of variables in the argument <code>groups</code> (by default, with <code>groups = NULL</code>, each explanatory variable is a different group). The variable importance of groups of variables is computed as the standardised regression coefficients summed across variable of the same group.<br>
We hereafter use this function to compute the relative importance of the abiotic versus biotic covariates.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">VarImpo</span> <span class="op">=</span> <span class="fu"><a href="../reference/computeVariableImportance.html">computeVariableImportance</a></span><span class="op">(</span><span class="va">m</span>, </span>
<span>                                    groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Abiotic"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"X_1"</span>,<span class="st">"X_2"</span><span class="op">)</span>,</span>
<span>                                                     <span class="st">"Biotic"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Y1"</span>,<span class="st">"Y2"</span>, <span class="st">"Y3"</span>, <span class="st">"Y4"</span>, <span class="st">"Y5"</span>, <span class="st">"Y6"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">VarImpo</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">VarImpo</span>, <span class="fl">2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">/</span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">+</span><span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tab</span> <span class="op">=</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">melt</a></span><span class="op">(</span><span class="va">VarImpo</span><span class="op">)</span></span>
<span><span class="va">tab</span><span class="op">$</span><span class="va">Var2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">tab</span><span class="op">$</span><span class="va">Var2</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">tab</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Var2</span>, y <span class="op">=</span> <span class="va">value</span>, fill <span class="op">=</span> <span class="va">Var1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat<span class="op">=</span><span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="fig/varImpo-1.png" alt=""><p class="caption">plot of chunk varImpo</p>
</div>
<p>We clearly see that our model correctly retrieved the simulated pattern, with the importance of biotic variables with respect to the abiotic ones becomes greater as the trophic level increases.</p>
<p>Finally, we can visualise the effect of each trophic interactions with the function <code>plotG_inferred</code>, which plots the metaweb <code>G</code> together with the variable importance (i.e. the standardised regression coefficient) of each link. The parameter <code>level</code> sets the confidence level with which coefficients are deemed as significant or non-significant.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotG_inferred.html">plotG_inferred</a></span><span class="op">(</span><span class="va">m</span>, level <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="fig/plotG-1.png" alt=""><p class="caption">plot of chunk plotG</p>
</div>
<p>We see that the model correctly retrieves that preys have a posite effect on the predators and that this effect becomes more important for predators at higher trophic positions.</p>
</div>
<div class="section level3">
<h3 id="analysis-of-local-models">Analysis of local models<a class="anchor" aria-label="anchor" href="#analysis-of-local-models"></a>
</h3>
<p>In order to examine the package and practice with it, we here show how to easily manipulate local models, i.e. each glm (that can be seen as a single species SDMs), the smallest pieces of trophic SDM. These local models belong to the class “SDMfit”, for which multiple methods exists. We hereafter show how to some of these methods for species Y6.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">SDM</span> <span class="op">=</span> <span class="va">m</span><span class="op">$</span><span class="va">model</span><span class="op">$</span><span class="va">Y6</span></span>
<span></span>
<span><span class="co"># The formula used to fit the model</span></span>
<span><span class="va">SDM</span><span class="op">$</span><span class="va">form.all</span></span>
<span><span class="co">#&gt; [1] "y ~ I(X_1^2)+I(X_2^2)+Y3+Y5"</span></span>
<span></span>
<span><span class="co"># The inferred model</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">SDM</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="fig/SDMfit-1.png" alt=""><p class="caption">plot of chunk SDMfit</p>
</div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># The regression coefficients</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">SDM</span>, level <span class="op">=</span> <span class="fl">0.9</span>, standardise <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="co">#&gt;                estimate          5%        95%</span></span>
<span><span class="co">#&gt; (Intercept) -0.26538390 -0.26538390 -0.2653839</span></span>
<span><span class="co">#&gt; I(X_1^2)     0.03710176 -0.31845069  0.3562105</span></span>
<span><span class="co">#&gt; I(X_2^2)    -0.09409905 -0.46564058  0.3202540</span></span>
<span><span class="co">#&gt; Y3           0.65666409  0.23736872  1.1462645</span></span>
<span><span class="co">#&gt; Y5           0.17503112  0.09559397  0.2615493</span></span></code></pre></div>
<p>We can also predict the probability of presence of species Y6 at a site with X_1 = 0.5, X_2 = 0.5, assuming its preys to be present present.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">preds</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">SDM</span>, newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>X_1 <span class="op">=</span> <span class="fl">0.5</span>, X_2 <span class="op">=</span> <span class="fl">0.5</span>, Y3 <span class="op">=</span> <span class="fl">1</span>, Y5 <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Posterior mean of the probability of presence</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">preds</span><span class="op">$</span><span class="va">predictions.prob</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.9979847</span></span></code></pre></div>
<p>We see that the species has a high probability of presence in this environmental conditions when its prey are present.</p>
</div>
</div>
<div class="section level2">
<h2 id="predictions-with-trophic-sdm">Predictions with trophic SDM<a class="anchor" aria-label="anchor" href="#predictions-with-trophic-sdm"></a>
</h2>
<p>We showed how to fit and analyse a trophic SDM and how to predict a single species (Y6 in the previous section), when we can fix the distribution of its prey. However, the distribution of prey is typically unavailable when we want to predict the distribution of species at unobserved sites and/or under future environmental conditions. Intuitively, in a simple network of two trophic level we would need to predict the prey first and use these predictions to predict the predator. To generalize this idea to complex networks, we predict species following the topological ordering of the metaweb. This order that exists for every DAG guarantees that when predicting a given species, all its prey will have already been predicted.<br>
The function <code>predict</code> computes the topological order of species, and then predicts them sequentially. As any <code>predict</code> function, it takes into account the values of the environmental variables in the argument <code>Xnew</code>. We can provide to the function the number of samples from the posterior distribution.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">m</span>, Xnew <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>X_1 <span class="op">=</span> <span class="fl">0.5</span>, X_2 <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>, pred_samples <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">pred</span><span class="op">$</span><span class="va">Y2</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1]   1 100</span></span></code></pre></div>
<p>By default, the function <code>predict</code> transforms the probability of presence of prey in presence-absence, and then use these presence-absences to predict the predator. However, we can use directly the probability of presence of prey by setting <code>prob.cov = TRUE</code>.</p>
<p>Pred is a list containing the posterior distribution of the predicted probability of presence of each species (i.e., number of sites x pred_samples). Notice that we can ask the function to directly provide a summary of the posterior distribution (i.e. posterior mean and 95% quantiles) of the probabilities of presence by setting <code>fullPost = FALSE</code>. As for <code>trophicSDM</code>, we can choose to parallelise some parts of the <code>predict</code> function by setting <code>run.parallel = TRUE</code> (which can speed up computational times).</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">m</span>, Xnew <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>X_1 <span class="op">=</span> <span class="fl">0.5</span>, X_2 <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>, pred_samples <span class="op">=</span> <span class="fl">100</span>, </span>
<span>               fullPost <span class="op">=</span> <span class="cn">FALSE</span>, run.parallel <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pred</span><span class="op">$</span><span class="va">Y2</span></span>
<span><span class="co">#&gt; $predictions.mean</span></span>
<span><span class="co">#&gt;         1 </span></span>
<span><span class="co">#&gt; 0.7984008 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $predictions.q025</span></span>
<span><span class="co">#&gt;         1 </span></span>
<span><span class="co">#&gt; 0.5854847 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $predictions.q975</span></span>
<span><span class="co">#&gt;         1 </span></span>
<span><span class="co">#&gt; 0.8850332</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="model-evaluation">Model evaluation<a class="anchor" aria-label="anchor" href="#model-evaluation"></a>
</h2>
<p>We now want to evaluate how well the model fits the data and how well it generalises to new data with respect to classical SDM. We thus first run a classical SDM, by providing an empty graph to <code>trophicSDM</code>. Then, we will compare model AIC and their predictive performances both on the training data and in cross-validation. Notice that when we compare classical SDM and trophic SDM it is important to account for the fact that trophic SDM have a higher number of parameters, and will therefore have, by default, a higher fit on the the training data.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">empty_graph</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/igraph/man/graph_from_adjacency_matrix.html" class="external-link">graph_from_adjacency_matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, nrow <span class="op">=</span> <span class="va">S</span>, ncol <span class="op">=</span> <span class="va">S</span>,</span>
<span>                                          dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">m_classic</span> <span class="op">=</span> <span class="fu"><a href="../reference/trophicSDM.html">trophicSDM</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="va">Y</span>, X <span class="op">=</span> <span class="va">X</span>,</span>
<span>                       G <span class="op">=</span> <span class="va">empty_graph</span>,</span>
<span>                       env.formula <span class="op">=</span> <span class="st">"~ I(X_1^2) + I(X_2^2)"</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span>, </span>
<span>                       method <span class="op">=</span> <span class="st">"stan_glm"</span>, chains <span class="op">=</span> <span class="va">nchains</span>, iter <span class="op">=</span> <span class="va">iter</span>, verbose <span class="op">=</span> <span class="va">verbose</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="aic-loo">AIC, loo<a class="anchor" aria-label="anchor" href="#aic-loo"></a>
</h3>
<p>We first compare model AIC and an approximation of the leave-one-out cross-validation log-likelihood (loo, see Vehtari, A. et al 2017). AIC penalises the likelihood of the model as a function of the number of model parameter, while loo approximate the likelihood of the model on leave-one out cross validation. Therefore, both these metrics can be used to correctly compare the two approaches</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">m</span><span class="op">$</span><span class="va">AIC</span></span>
<span><span class="co">#&gt; [1] 1455.721</span></span>
<span><span class="va">m_classic</span><span class="op">$</span><span class="va">AIC</span></span>
<span><span class="co">#&gt; [1] 1584.531</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://mc-stan.org/loo/reference/loo.html" class="external-link">loo</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Found 1 observation(s) with a pareto_k &gt; 0.7. We recommend calling 'loo' again with argument 'k_threshold = 0.7' in order to calculate the ELPD without the assumption that these observations are negligible. This will refit the model 1 times to compute the ELPDs for the problematic observations directly.</span></span>
<span><span class="co">#&gt; [1] -707.6043</span></span>
<span><span class="fu"><a href="https://mc-stan.org/loo/reference/loo.html" class="external-link">loo</a></span><span class="op">(</span><span class="va">m_classic</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -777.2048</span></span></code></pre></div>
<p>We see that our trophic model has a lower AIC and a higher loo, which proves that including prey improves the model.</p>
</div>
<div class="section level3">
<h3 id="interpolation">Interpolation<a class="anchor" aria-label="anchor" href="#interpolation"></a>
</h3>
<p>We now compare the predictive performance of the two approaches on the training dataset. To do so, we first use the function <code>predict</code>, and then the function <code>evaluateModelFit</code> to compare how well predictions match the true data.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Trophic SDM (when Xnew is not specified, predictions are carried on</span></span>
<span><span class="co"># the training dataset by setting Xnew = m$data$X)</span></span>
<span><span class="va">Ypred</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">m</span>, fullPost <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co"># Transfom in a table</span></span>
<span><span class="va">Ypred</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">cbind</span>,</span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">Ypred</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">predictions.mean</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Re order columns</span></span>
<span><span class="va">Ypred</span> <span class="op">=</span> <span class="va">Ypred</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">metrics</span> <span class="op">=</span> <span class="fu"><a href="../reference/evaluateModelFit.html">evaluateModelFit</a></span><span class="op">(</span><span class="va">m</span>, Ynew <span class="op">=</span> <span class="va">Y</span>, Ypredicted <span class="op">=</span> <span class="va">Ypred</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Classical SDM</span></span>
<span><span class="va">Ypred_classic</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">m</span>, fullPost <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">Ypred_classic</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">cbind</span>,</span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">Ypred_classic</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">predictions.mean</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Ypred_classic</span> <span class="op">=</span> <span class="va">Ypred_classic</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">metrics_classic</span> <span class="op">=</span> <span class="fu"><a href="../reference/evaluateModelFit.html">evaluateModelFit</a></span><span class="op">(</span><span class="va">m</span>, Ynew <span class="op">=</span> <span class="va">Y</span>, Ypredicted <span class="op">=</span> <span class="va">Ypred_classic</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Mean AUC</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">metrics</span><span class="op">$</span><span class="va">auc</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.8084933</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">metrics_classic</span><span class="op">$</span><span class="va">auc</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.7980231</span></span>
<span></span>
<span><span class="co"># Mean TSS</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">metrics</span><span class="op">$</span><span class="va">tss</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.5446994</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">metrics_classic</span><span class="op">$</span><span class="va">tss</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.5234593</span></span></code></pre></div>
<p>On the training dataset models have similar performances, with our trophic model that slightly improves SDM’s TSS.</p>
</div>
<div class="section level3">
<h3 id="cross-validation">Cross-validation<a class="anchor" aria-label="anchor" href="#cross-validation"></a>
</h3>
<p>We now compare the two approaches in K-fold cross validation with the function <code>trophicSDM_CV</code>. This function creates a partition based on the specified number of fold (but can also takes a user-specified partition in the argument <code>partition</code>) and run a cross validation. This can take a bit of time. Set <code>run.parallel = TRUE</code> if you want to reduce computation time.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 3-fold cross validation</span></span>
<span><span class="va">CV</span> <span class="op">=</span> <span class="fu"><a href="../reference/trophicSDM_CV.html">trophicSDM_CV</a></span><span class="op">(</span><span class="va">m</span>, K <span class="op">=</span> <span class="fl">3</span>, prob.cov <span class="op">=</span> <span class="cn">T</span>, iter <span class="op">=</span> <span class="fl">2000</span>,</span>
<span>                   pred_samples <span class="op">=</span> <span class="fl">500</span>, run.parallel <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Fold 1 out of 3 \n"</span></span>
<span><span class="co">#&gt; [1] "Fold 2 out of 3 \n"</span></span>
<span><span class="co">#&gt; [1] "Fold 3 out of 3 \n"</span></span>
<span><span class="co"># Transfom in a table</span></span>
<span><span class="va">Ypred</span> <span class="op">=</span> <span class="va">CV</span><span class="op">$</span><span class="va">meanPred</span></span>
<span><span class="co"># Re order columns</span></span>
<span><span class="va">Ypred</span> <span class="op">=</span> <span class="va">Ypred</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">metrics</span> <span class="op">=</span> <span class="fu"><a href="../reference/evaluateModelFit.html">evaluateModelFit</a></span><span class="op">(</span><span class="va">m</span>, Ynew <span class="op">=</span> <span class="va">Y</span>, Ypredicted <span class="op">=</span> <span class="va">Ypred</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Classical SDM</span></span>
<span></span>
<span><span class="co"># We specify the same partition for classic SDM so that the two cross-validations are comparable.</span></span>
<span></span>
<span><span class="va">CV_classic</span> <span class="op">=</span> <span class="fu"><a href="../reference/trophicSDM_CV.html">trophicSDM_CV</a></span><span class="op">(</span><span class="va">m_classic</span>, K <span class="op">=</span> <span class="fl">3</span>, prob.cov <span class="op">=</span> <span class="cn">T</span>, iter <span class="op">=</span> <span class="fl">2000</span>,</span>
<span>                           pred_samples <span class="op">=</span> <span class="fl">500</span>, run.parallel <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                           partition <span class="op">=</span> <span class="va">CV</span><span class="op">$</span><span class="va">partition</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Fold 1 out of 3 \n"</span></span>
<span><span class="co">#&gt; [1] "Fold 2 out of 3 \n"</span></span>
<span><span class="co">#&gt; [1] "Fold 3 out of 3 \n"</span></span>
<span></span>
<span><span class="va">Ypred_classic</span> <span class="op">=</span> <span class="va">CV_classic</span><span class="op">$</span><span class="va">meanPred</span></span>
<span></span>
<span><span class="va">Ypred_classic</span> <span class="op">=</span> <span class="va">Ypred_classic</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">metrics_classic</span> <span class="op">=</span> <span class="fu"><a href="../reference/evaluateModelFit.html">evaluateModelFit</a></span><span class="op">(</span><span class="va">m</span>, Ynew <span class="op">=</span> <span class="va">Y</span>, Ypredicted <span class="op">=</span> <span class="va">Ypred_classic</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Mean AUC</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">metrics</span><span class="op">$</span><span class="va">auc</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.697824</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">metrics_classic</span><span class="op">$</span><span class="va">auc</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.6669216</span></span>
<span></span>
<span><span class="co"># Mean TSS</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">metrics</span><span class="op">$</span><span class="va">tss</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.4223416</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">metrics_classic</span><span class="op">$</span><span class="va">tss</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.3722708</span></span></code></pre></div>
<p>The increase in mean AUC and TSS is even higher in 3-fold cross-validation than on the fitted data. As we simulated the data with a strong biotic signal, trophic SDM proves to be a better tool than classic SDM.</p>
</div>
</div>
<div class="section level2">
<h2 id="fundamental-niche">Fundamental niche<a class="anchor" aria-label="anchor" href="#fundamental-niche"></a>
</h2>
<p>We also implemented a function to predict species fundamental niches, defined as the probability of presence of species along the environmental gradient when the biotic constrain is realised, i.e., when all its prey are set to present (vice-versa, when modeling species top-down, when the predator are absent). We here compute the probability of presence of species at environmental conditions X_1= 0.5, X_2 = 0.5 when the preys are available.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">preds</span> <span class="op">=</span> <span class="fu"><a href="../reference/predictFundamental.html">predictFundamental</a></span><span class="op">(</span><span class="va">m</span>, Xnew <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>X_1 <span class="op">=</span> <span class="fl">0.5</span>, X_2 <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Take the posterior mean</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">preds</span>,<span class="va">mean</span><span class="op">)</span></span>
<span><span class="co">#&gt; $Y1</span></span>
<span><span class="co">#&gt; [1] 0.7512132</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Y2</span></span>
<span><span class="co">#&gt; [1] 0.835708</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Y3</span></span>
<span><span class="co">#&gt; [1] 0.9535799</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Y4</span></span>
<span><span class="co">#&gt; [1] 0.9859788</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Y5</span></span>
<span><span class="co">#&gt; [1] 0.9998674</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Y6</span></span>
<span><span class="co">#&gt; [1] 0.9984503</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a>
</h2>
<p>This package is currently developed by Giovanni Poggiato from Laboratoire d’Ecologie Alpine. It is supported by the ANR GAMBAS. The framework implemented in this package is described in: “Integrating trophic food webs in species distribution models improves ecological niche estimation and prediction” Poggiato Giovanni, Jérémy Andréoletti, Laura J. Pollock and Wilfried Thuiller. In preparation.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Grace, J. B., Johnson, D. J., Lefcheck, J. S., and Byrnes, J. E. K.. 2018. Quantifying relative importance: computing standardized effects in models with binary outcomes. Ecosphere 9(6):e02283.</p>
<p>Vehtari, A., Gelman, A., and Gabry, J. (2017). Practical Bayesian model evaluation using leave-one-out cross-validation and WAIC. Statistics and Computing. 27(5), 1413–1432.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Giovanni Poggiato, Jérémy Andréoletti.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
